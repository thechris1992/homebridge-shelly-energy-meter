{
  "pluginAlias": "ShellyEnergyMeter",
  "pluginType": "platform",
  "singular": false,
  "headerDisplay": "Shelly 3EM/EM Energy Meter Platform - Fixed Phase Support",
  "footerDisplay": "ðŸ“± Energy characteristics only visible in EVE app | ðŸ”§ 3EM uses 3 phases, EM uses 2 phases automatically",
  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "title": "Platform Name",
        "type": "string",
        "default": "Shelly Energy Meters",
        "required": true
      },
      "devices": {
        "title": "Energy Meter Devices",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": {
              "title": "Device Name",
              "type": "string",
              "required": true,
              "description": "Display name for this device"
            },
            "ip": {
              "title": "IP Address",
              "type": "string",
              "required": true,
              "format": "ipv4",
              "description": "IP address of the Shelly device"
            },   
            "auth": {
              "title": "Authentication",
              "type": "object",
              "properties": {
                "user": {
                  "title": "Username",
                  "type": "string"
                },
                "pass": {
                  "title": "Password",
                  "type": "string"
                }
              },
              "description": "Optional authentication for protected devices"
            },
            "timeout": {
              "title": "Timeout (ms)",
              "type": "integer",
              "default": 5000,
              "minimum": 1000,
              "maximum": 30000
            },
            "update_interval": {
              "title": "Update Interval (ms)",
              "type": "integer",
              "default": 10000,
              "minimum": 5000,
              "maximum": 60000,
              "description": "Must be greater than timeout"
            },
            "device_type": {
              "title": "ðŸ“¡ Device Type",
              "type": "string",
              "default": "3EM",
              "enum": ["3EM", "EM"],
              "description": "Shelly 3EM (3 phases) or Shelly EM (2 phases) - Missing phases will be set to 0"
            },
            "use_pf": {
              "title": "Use Power Factor (pf) when calculating Total Ampere",
              "type": "boolean",
              "default": false,
              "required": true
            },
            "enable_consumption": {
              "title": "Enable Instant Consumption Characteristic",
              "type": "boolean",
              "default": true,
              "required": true,
              "description": "Disable to hide the Consumption characteristic."
            },
            "enable_total_consumption": {
              "title": "Enable Total Consumption Characteristic",
              "type": "boolean",
              "default": true,
              "required": true,
              "description": "Disable to hide the Total Energy characteristic."
            },
            "enable_voltage": {
              "title": "Enable Voltage Characteristic",
              "type": "boolean",
              "default": true,
              "required": true,
              "description": "Disable to hide the Voltage characteristic."
            },
            "enable_ampere": {
              "title": "Enable Current Characteristic",
              "type": "boolean",
              "default": true,
              "required": true,
              "description": "Disable to hide the Current characteristic."
            },
            "use_em_mode": {
              "title": "ðŸ“Š EM Channel Mode",
              "type": "integer",
              "default": 0,
              "minimum": 0,
              "maximum": 2,
              "description": "0=combine all channels, 1=channel 1 only, 2=channel 2 only (EM only)",
              "condition": {
                "functionBody": "return model.device_type === 'EM';"
              }
            }, 
            "negative_handling_mode": {
              "title": "Negative Values",
              "type": "integer",
              "default": 0,
              "minimum": 0,
              "maximum": 1,
              "description": "0=set to zero, 1=show absolute value"
            },
            "debug_log": {
              "title": "Debug Logging",
              "type": "boolean",
              "default": false,
              "description": "Enable detailed logging for this device"
            },
            "serial": {
              "title": "Serial Number",
              "type": "string",
              "description": "Custom serial (auto-generated if empty)"
            }
          },
          "required": ["name", "ip"]
        }
      }
    },
    "required": ["name", "devices"]
  }
}
